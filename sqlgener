splitLine:
  parse arg line, sep, stem.
  stem.0 = 0
  line = strip(line); if line='' then return 0
  tmp = line; i=0
  if sep=' ' then do
    do while tmp<>''
      parse var tmp fld tmp
      i=i+1; stem.i = strip(fld)
    end
  end
  else do
    do forever
      parse var tmp fld (sep) tmp
      i=i+1; stem.i = strip(fld)
      if pos(sep,tmp)=0 then do
        if tmp<>'' then do; i=i+1; stem.i=strip(tmp); end
        leave
      end
    end
  end
  stem.0 = i + 0            /* wymuś wartość numeryczną */
  return i


hdr = strip(in.1)
if DELIM = '' then DELIM = detectDelim(hdr)

cols. = ''
call splitLine hdr, DELIM, cols.

/* dla bezpieczeństwa używaj ncols */
if datatype(cols.0,'W') <> 1 then do
  say 'ERROR: cols.0 nienumeryczne: "'cols.0'".'
  exit 16
end
ncols = cols.0 + 0

do i = 1 to ncols
  /* ... */
end
